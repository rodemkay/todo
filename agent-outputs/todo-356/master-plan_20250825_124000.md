# üéØ MASTER PLAN - Prompt-Output System

## üìÖ Konzept: 2025-08-25 12:40

## üöÄ DIE L√ñSUNG: Ein zentraler Prompt-Output

### Kernidee:
Statt dass todo_manager.py einzelne Felder liest und interpretiert, generieren wir einen **vollst√§ndigen Prompt-Output** aus allen Formularwerten, der ALLE Anweisungen enth√§lt.

## üìä ARCHITEKTUR

```
[Formular] ‚Üí [Live-Generierung] ‚Üí [prompt_output Spalte] ‚Üí [todo_manager.py liest NUR das]
```

### Workflow:
1. User f√ºllt Formular aus (Agent-Anzahl, MCP-Server, etc.)
2. JavaScript generiert LIVE einen vollst√§ndigen Prompt
3. Prompt wird in neue Spalte `prompt_output` gespeichert
4. todo_manager.py liest NUR noch `prompt_output`
5. Claude Code erh√§lt KLARE, EXPLIZITE Anweisungen

## üîß IMPLEMENTATION PLAN

### Phase 1: Datenbank-Migration
```sql
ALTER TABLE stage_project_todos 
ADD COLUMN prompt_output TEXT AFTER claude_prompt;
```

### Phase 2: JavaScript Live-Generator
```javascript
function generatePromptOutput() {
    let prompt = "ANWEISUNGEN F√úR CLAUDE CODE:\n\n";
    
    // Agent-Anzahl
    if ($('#agents').val() > 0) {
        prompt += `ü§ñ VERWENDE ${$('#agents').val()} AGENTS f√ºr diese Aufgabe.\n`;
        prompt += "Orchestriere mehrere Subagents f√ºr eine umfassende Analyse.\n\n";
    }
    
    // Agent-Output-Modus
    if ($('#save_agent_outputs').is(':checked')) {
        prompt += "üìÅ AGENT OUTPUT MODUS AKTIVIERT:\n";
        prompt += "- Speichere ALLE Analysen als .md Dateien\n";
        prompt += "- Verwende das Write Tool f√ºr Dokumentation\n\n";
    }
    
    // MCP-Server
    let mcpServers = [];
    $('.mcp-checkbox:checked').each(function() {
        mcpServers.push($(this).val());
    });
    if (mcpServers.length > 0) {
        prompt += "üîå MCP-SERVER VERF√úGBAR:\n";
        mcpServers.forEach(server => {
            prompt += `- ${server}\n`;
        });
        prompt += "\n";
    }
    
    // Hauptaufgabe
    prompt += "üìã AUFGABE:\n";
    prompt += $('#title').val() + "\n\n";
    prompt += "üìù BESCHREIBUNG:\n";
    prompt += $('#description').val() + "\n\n";
    
    // Working Directory
    if ($('#working_directory').val()) {
        prompt += "üìÇ ARBEITSVERZEICHNIS:\n";
        prompt += $('#working_directory').val() + "\n\n";
    }
    
    return prompt;
}
```

### Phase 3: todo_manager.py Vereinfachung
```python
def load_todo(todo_id):
    # NUR noch prompt_output lesen!
    query = f"SELECT prompt_output FROM stage_project_todos WHERE id={todo_id}"
    prompt = execute_query(query)
    
    # Direkt ausgeben
    print(prompt)
    # Fertig! Keine komplexe Logik mehr n√∂tig
```

## üéØ VORTEILE

1. **EXPLIZITE ANWEISUNGEN** - Claude erh√§lt klare Befehle
2. **LIVE-PREVIEW** - User sieht genau was √ºbergeben wird
3. **EINFACHE WARTUNG** - Nur eine Stelle f√ºr √Ñnderungen
4. **FLEXIBEL** - Neue Features einfach hinzuf√ºgbar
5. **NACHVOLLZIEHBAR** - Prompt ist in DB gespeichert

## üìã AUFGABEN F√úR AGENTS

### Agent 1: Database Architect
- Datenbank-Migration durchf√ºhren
- prompt_output Spalte hinzuf√ºgen
- Trigger f√ºr Auto-Update bei √Ñnderungen

### Agent 2: Frontend Developer
- JavaScript Live-Generator implementieren
- Preview-Box im Formular
- Auto-Update bei Feld√§nderungen

### Agent 3: Backend Developer
- todo_manager.py vereinfachen
- Nur noch prompt_output lesen
- Alte Logik als Fallback behalten

### Agent 4: Integration Tester
- End-to-End Test des Systems
- Verifizierung der Prompt-Generierung
- Test der Agent-Anweisungen

### Agent 5: Documentation Writer
- Vollst√§ndige Dokumentation
- Beispiel-Prompts
- Migration Guide

---

*Master Plan erstellt f√ºr Todo #356*