<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TODO #207 - Formular Daten√ºbertragungsanalyse</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            border-bottom: 3px solid #dc3545;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #dc3545;
            margin: 0 0 10px 0;
            font-size: 2.2em;
        }
        .header .meta {
            color: #666;
            font-size: 1.1em;
        }
        .problem-summary {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .problem-summary h2 {
            color: #856404;
            margin-top: 0;
        }
        .success-rate {
            text-align: center;
            font-size: 3em;
            font-weight: bold;
            color: #dc3545;
            margin: 20px 0;
        }
        .data-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .expected, .actual {
            padding: 20px;
            border-radius: 6px;
        }
        .expected {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        .expected h3 {
            color: #155724;
            margin-top: 0;
        }
        .actual {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .actual h3 {
            color: #721c24;
            margin-top: 0;
        }
        .field-item {
            margin: 15px 0;
            padding: 10px;
            background: rgba(255,255,255,0.7);
            border-radius: 4px;
        }
        .field-name {
            font-weight: bold;
            color: #333;
        }
        .field-value {
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.05);
            padding: 5px 8px;
            border-radius: 3px;
            margin-top: 5px;
        }
        .status-icon {
            font-size: 1.2em;
            margin-right: 8px;
        }
        .success { color: #28a745; }
        .failure { color: #dc3545; }
        .technical-details {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 20px;
            margin: 30px 0;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .sql-query {
            background: #1a202c;
            color: #63b3ed;
        }
        .action-plan {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 30px 0;
        }
        .action-plan h3 {
            color: #1565c0;
            margin-top: 0;
        }
        .priority-high {
            color: #dc3545;
            font-weight: bold;
        }
        .priority-medium {
            color: #fd7e14;
            font-weight: bold;
        }
        .priority-low {
            color: #6f42c1;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .timestamp {
            color: #6c757d;
            font-size: 0.9em;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üö® TODO #207 - Kritische Formular-Daten√ºbertragungsanalyse</h1>
            <div class="meta">
                <strong>Todo-Titel:</strong> TEST 2: Maximum Config<br>
                <strong>Beschreibung:</strong> Alle Felder maximal ausgef√ºllt<br>
                <strong>Status:</strong> In Bearbeitung<br>
                <strong>Priorit√§t:</strong> Hoch<br>
                <strong>Analysiert am:</strong> <span class="timestamp">2025-08-21 13:45:00</span>
            </div>
        </header>

        <div class="problem-summary">
            <h2>üîç PROBLEM-ZUSAMMENFASSUNG</h2>
            <p>Bei der Verifikation des WordPress Todo-Formulars wurde ein <strong>kritisches Daten√ºbertragungsproblem</strong> identifiziert. Trotz vollst√§ndiger Ausf√ºllung aller erweiterten Formularfelder werden <strong>86% der eingegebenen Daten nicht in der Datenbank gespeichert</strong>.</p>
            
            <div class="success-rate">
                ERFOLGSRATE: 14% (1/7 Felder)
            </div>
        </div>

        <div class="data-comparison">
            <div class="expected">
                <h3>‚úÖ ERWARTETE DATEN (Formular-Eingaben)</h3>
                
                <div class="field-item">
                    <div class="field-name">Claude Prompt:</div>
                    <div class="field-value">"CUSTOM PROMPT: Arbeite mit 3 Agents parallel und nutze Context7 + GitHub f√ºr diese spezielle Aufgabe. Priorit√§t: HOCH"</div>
                </div>

                <div class="field-item">
                    <div class="field-name">Agent Count:</div>
                    <div class="field-value">8-10 Agents</div>
                </div>

                <div class="field-item">
                    <div class="field-name">MCP Server:</div>
                    <div class="field-value">["context7","github"] (Nur 2 aktiviert)</div>
                </div>

                <div class="field-item">
                    <div class="field-name">Development Area:</div>
                    <div class="field-value">Full-Stack</div>
                </div>

                <div class="field-item">
                    <div class="field-name">Execution Mode:</div>
                    <div class="field-value">parallel</div>
                </div>

                <div class="field-item">
                    <div class="field-name">Working Directory:</div>
                    <div class="field-value">/tmp/</div>
                </div>

                <div class="field-item">
                    <div class="field-name">Bemerkungen:</div>
                    <div class="field-value">"Wichtige Test-Bemerkungen f√ºr Claude"</div>
                </div>
            </div>

            <div class="actual">
                <h3>‚ùå TATS√ÑCHLICHE DATEN (Datenbank)</h3>
                
                <div class="field-item">
                    <div class="field-name"><span class="status-icon failure">‚ùå</span>Claude Prompt:</div>
                    <div class="field-value">NULL</div>
                </div>

                <div class="field-item">
                    <div class="field-name"><span class="status-icon failure">‚ùå</span>Agent Count:</div>
                    <div class="field-value">0</div>
                </div>

                <div class="field-item">
                    <div class="field-name"><span class="status-icon failure">‚ùå</span>MCP Server:</div>
                    <div class="field-value">NULL</div>
                </div>

                <div class="field-item">
                    <div class="field-name"><span class="status-icon success">‚úÖ</span>Development Area:</div>
                    <div class="field-value">fullstack</div>
                </div>

                <div class="field-item">
                    <div class="field-name"><span class="status-icon failure">‚ùå</span>Execution Mode:</div>
                    <div class="field-value">default</div>
                </div>

                <div class="field-item">
                    <div class="field-name"><span class="status-icon failure">‚ùå</span>Working Directory:</div>
                    <div class="field-value">/home/rodemkay/www/react/todo/</div>
                </div>

                <div class="field-item">
                    <div class="field-name"><span class="status-icon failure">‚ùå</span>Bemerkungen:</div>
                    <div class="field-value">NULL</div>
                </div>
            </div>
        </div>

        <div class="technical-details">
            <h3>üîß TECHNISCHE DETAILS</h3>
            
            <h4>Datenbank-Verifikationsquery:</h4>
            <div class="code-block sql-query">
SELECT id, title, claude_prompt, agent_count, mcp_servers, 
       development_area, execution_mode, working_directory, bemerkungen 
FROM stage_project_todos 
WHERE id = 207
            </div>

            <h4>Betroffene WordPress-Dateien:</h4>
            <ul>
                <li><strong>/wp-content/plugins/todo/admin/new-todo.php</strong> - Formular-HTML Template</li>
                <li><strong>/wp-content/plugins/todo/todo.php</strong> - POST-Datenverarbeitung (Zeile ~247)</li>
                <li><strong>/wp-content/plugins/todo/admin/new-todo-v2.php</strong> - Alternative Formular-Version</li>
            </ul>

            <h4>POST-Verarbeitungslogik (todo.php:247):</h4>
            <div class="code-block">
$data = [
    'claude_prompt' => wp_kses_post($_POST['claude_prompt'] ?? ''),
    'agent_count' => intval($_POST['agent_count'] ?? 1),
    'mcp_servers' => json_encode($mcp_servers_array),
    'development_area' => sanitize_text_field($_POST["dev_area"] ?? "Backend"),
    'execution_mode' => sanitize_text_field($_POST["execution_mode"] ?? "default"),
    'working_directory' => sanitize_text_field($_POST['working_directory'] ?? ''),
    'bemerkungen' => wp_kses_post($_POST['bemerkungen'] ?? ''),
];
            </div>
        </div>

        <div class="action-plan">
            <h3>üìã DETAILLIERTER AKTIONSPLAN</h3>
            
            <h4><span class="priority-high">PRIORIT√ÑT 1 - KRITISCH:</span></h4>
            <ol>
                <li><strong>POST-Daten-Debugging:</strong>
                    <ul>
                        <li>F√ºge error_log() Statements in todo.php hinzu um $_POST Array zu loggen</li>
                        <li>√úberpr√ºfe ob Formular-Namen korrekt sind (claude_prompt vs. andere)</li>
                        <li>Teste Browser Developer Tools Network Tab f√ºr POST-Request</li>
                    </ul>
                </li>
                
                <li><strong>JavaScript-Formular-Validation:</strong>
                    <ul>
                        <li>Pr√ºfe ob JavaScript die Formular-Daten vor Submit manipuliert</li>
                        <li>√úberpr√ºfe AJAX vs. Standard Form Submit Logic</li>
                        <li>Teste Formular ohne JavaScript aktiviert</li>
                    </ul>
                </li>
            </ol>

            <h4><span class="priority-medium">PRIORIT√ÑT 2 - HOCH:</span></h4>
            <ol>
                <li><strong>MCP Server Array Verarbeitung:</strong>
                    <ul>
                        <li>Debugge wie Checkbox-Arrays verarbeitet werden</li>
                        <li>√úberpr√ºfe JSON-Encoding der MCP Server Liste</li>
                        <li>Teste verschiedene Browser f√ºr Checkbox-Verhalten</li>
                    </ul>
                </li>
                
                <li><strong>Agent Count Field Mapping:</strong>
                    <ul>
                        <li>Verifiziere HTML input name="agent_count"</li>
                        <li>√úberpr√ºfe intval() Konvertierung</li>
                        <li>Teste Edge-Cases (0, negative Werte, sehr hohe Zahlen)</li>
                    </ul>
                </li>
            </ol>

            <h4><span class="priority-low">PRIORIT√ÑT 3 - MITTEL:</span></h4>
            <ol>
                <li><strong>Dropdown-Verarbeitung:</strong>
                    <ul>
                        <li>Working Directory Selection Logic</li>
                        <li>Development Area Mapping</li>
                        <li>Execution Mode Selection</li>
                    </ul>
                </li>
                
                <li><strong>Textarea Content Preservation:</strong>
                    <ul>
                        <li>Claude Prompt mit Sonderzeichen</li>
                        <li>Bemerkungen Feld mit HTML-Content</li>
                        <li>wp_kses_post() Filter-Effekte</li>
                    </ul>
                </li>
            </ol>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Feld</th>
                    <th>Formular HTML Name</th>
                    <th>DB Spalte</th>
                    <th>Status</th>
                    <th>Priorit√§t Fix</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Claude Prompt</td>
                    <td>claude_prompt</td>
                    <td>claude_prompt</td>
                    <td><span class="failure">‚ùå NULL</span></td>
                    <td><span class="priority-high">KRITISCH</span></td>
                </tr>
                <tr>
                    <td>Agent Count</td>
                    <td>agent_count</td>
                    <td>agent_count</td>
                    <td><span class="failure">‚ùå 0 statt 8-10</span></td>
                    <td><span class="priority-high">KRITISCH</span></td>
                </tr>
                <tr>
                    <td>MCP Servers</td>
                    <td>mcp_servers[]</td>
                    <td>mcp_servers</td>
                    <td><span class="failure">‚ùå NULL</span></td>
                    <td><span class="priority-high">KRITISCH</span></td>
                </tr>
                <tr>
                    <td>Development Area</td>
                    <td>dev_area</td>
                    <td>development_area</td>
                    <td><span class="success">‚úÖ fullstack</span></td>
                    <td>OK</td>
                </tr>
                <tr>
                    <td>Execution Mode</td>
                    <td>execution_mode</td>
                    <td>execution_mode</td>
                    <td><span class="failure">‚ùå default statt parallel</span></td>
                    <td><span class="priority-medium">HOCH</span></td>
                </tr>
                <tr>
                    <td>Working Directory</td>
                    <td>working_directory</td>
                    <td>working_directory</td>
                    <td><span class="failure">‚ùå Standard statt /tmp/</span></td>
                    <td><span class="priority-medium">HOCH</span></td>
                </tr>
                <tr>
                    <td>Bemerkungen</td>
                    <td>bemerkungen</td>
                    <td>bemerkungen</td>
                    <td><span class="failure">‚ùå NULL</span></td>
                    <td><span class="priority-low">MITTEL</span></td>
                </tr>
            </tbody>
        </table>

        <div class="technical-details">
            <h3>üß™ EMPFOHLENE TEST-STRATEGIE</h3>
            
            <h4>Phase 1 - Isolierter Field-Test:</h4>
            <div class="code-block">
// Debug-Code f√ºr todo.php (nach Zeile 240):
error_log('=== FORM DEBUG START ===');
error_log('POST Data: ' . print_r($_POST, true));
error_log('claude_prompt: ' . var_export($_POST['claude_prompt'] ?? 'NOT_SET', true));
error_log('agent_count: ' . var_export($_POST['agent_count'] ?? 'NOT_SET', true));
error_log('mcp_servers: ' . print_r($_POST['mcp_servers'] ?? 'NOT_SET', true));
error_log('=== FORM DEBUG END ===');
            </div>

            <h4>Phase 2 - Browser Network Analysis:</h4>
            <ul>
                <li>Chrome DevTools ‚Üí Network Tab ‚Üí POST Request Body analysieren</li>
                <li>Vergleich Formular-HTML vs. tats√§chlich gesendete Daten</li>
                <li>AJAX vs. Standard Form Submit differentzieren</li>
            </ul>

            <h4>Phase 3 - Minimal Reproduction:</h4>
            <ul>
                <li>Einzelne Felder isoliert testen</li>
                <li>Schrittweise Komplexit√§t aufbauen</li>
                <li>A/B Test zwischen new-todo.php und new-todo-v2.php</li>
            </ul>
        </div>

        <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #dee2e6; color: #6c757d; text-align: center;">
            <p><strong>WordPress Todo-Plugin Diagnostik</strong> | Claude Code CLI Analysis | <span class="timestamp">Generated: 2025-08-21 13:45:00</span></p>
            <p>Status: In Bearbeitung - Weitere Debugging-Schritte erforderlich</p>
        </footer>
    </div>
</body>
</html>